<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
  </head>
  <body>
    <style>
      #myContainer {
        width: 100%;
        height: 650px;
      }

      canvas {
        width: 100%;
        height: 100%;
      }
    </style>
    <div id="myContainer"></div>
    <script
      async
      src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"
    ></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.154.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.154.0/examples/jsm/"
        }
      }
    </script>
    <script type="module">
      import * as THREE from "https://unpkg.com/three@0.154.0/build/three.module.js";
      import { GLTFLoader } from "https://unpkg.com/three@0.154.0/examples/jsm/loaders/GLTFLoader.js";
      import { OrbitControls } from "https://unpkg.com/three@0.154.0/examples/jsm/controls/OrbitControls.js";
      const canvas = document.querySelector("#myContainer canvas");
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0xffffff);
      const loader = new GLTFLoader();
      let gltfModel = null;
      const uniforms = {
        u_time: {
          value: 0.0,
        },
      };
      const shadowMaterial = new THREE.ShadowMaterial({
        opacity: 0.4,
      });
      const container = document.querySelector("#myContainer");
      const sizes = {
        width: container.offsetWidth,
        height: container.offsetHeight,
      };
      const camera = new THREE.PerspectiveCamera(
        75,
        sizes.width / sizes.height,
        0.1,
        100
      );
      camera.position.z = 6.2;
      scene.add(camera);

      function isMobileDevice() {
        return window.innerWidth <= 550; // You can adjust this value to target specific devices
      }

      function isTabletDevice() {
        return window.innerWidth > 740 && window.innerWidth <= 1200; // Adjust these values as needed
      }
      if (isMobileDevice()) {
        container.style.height = "450px"; 
        container.style.marginTop = "-200px"; 
      } else if (isTabletDevice()) {
        container.style.height = "450px"; 
        container.style.marginTop = "0";
        container.style.marginBottom = "100px";
      } else {
        container.style.height = "650px"; 
        container.style.marginTop = "0"; 
      }
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(sizes.width, sizes.height);
      container.appendChild(renderer.domElement);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      var controls = new OrbitControls(camera, renderer.domElement);
      controls.autoRotate = true;
      controls.enableDamping = true;
      controls.maxPolarAngle = Math.PI / 2 - 0.1;
      controls.minDistance = 0;
      controls.maxDistance = 15;
      controls.enablePan = false;
      controls.autoRotateSpeed = 0.5;
      controls.enableZoom = false;
      const clock = new THREE.Clock();

      function loadGLTFModel() {
        loader.load(
          "https://egnite.gr/wp-content/uploads/2023/08/mecano_logo.glb",
          function (gltf) {
            gltfModel = gltf.scene;
            gltfModel.traverse(function (child) {
              if (child.isMesh) {
                child.castShadow = true;
              }
            });
            if (isMobileDevice()) {
              gltfModel.scale.set(0.65, 0.65, 0.65);
            } else if (isTabletDevice()) {
              gltfModel.scale.set(0.89, 0.89, 0.89); // Adjust scale for tablets
            } else {
              gltfModel.scale.set(1.1, 1.1, 1.1);
            }
            gltfModel.rotation.x = Math.PI / 2; // Rotate the model 90 degrees on the x-axis
            scene.add(gltf.scene);
          },
          function (xhr) {
            console.log((xhr.loaded / xhr.total) * 100 + "% loaded");
          },
          function (error) {
            console.log("An error happened");
          }
        );
      }

      function loadShadowTexture() {
        // Load shadow texture
        const textureLoader = new THREE.TextureLoader();
        const shadowTexture = textureLoader.load(
          "https://egnite.gr/wp-content/uploads/2023/08/shadowtexture.png"
        );
        // Create a plane geometry with a smaller size
        const planeGeometry = new THREE.PlaneGeometry(5.5, 2); // Adjust these values to control the shadow size
        // Create a material using the shadow texture and setting the opacity
        const planeMaterial = new THREE.MeshBasicMaterial({
          map: shadowTexture,
          transparent: true,
          opacity: 0.13, // Adjust this value to control the shadow opacity
        });
        // Create a mesh with the geometry and material
        const planeMesh = new THREE.Mesh(planeGeometry, planeMaterial);
        // Position the plane beneath your model
        if (isMobileDevice()) {
          planeMesh.position.y = -1.7;
          planeGeometry.scale(0.65, 0.65, 0.65);
        } else if (isTabletDevice()) {
          planeMesh.position.y = -2; // Adjust position for tablets
          planeGeometry.scale(0.99, 0.99, 0.99); // Adjust scale for tablets
        } else {
          planeMesh.position.y = -3;
        }
        planeMesh.rotation.x = -Math.PI / 2; // Rotate the plane to be horizontal
        // Add the plane mesh to your scene
        scene.add(planeMesh);
      }

      function addLights() {
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.1);
        scene.add(ambientLight);
        const hemisphereLight = new THREE.HemisphereLight(
          0xffffff,
          0x404040,
          0.2
        ); // Adjust colors and intensity
        scene.add(hemisphereLight);

        const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.2);
        directionalLight1.position.set(0, 2, 2);
        directionalLight1.castShadow = true;
        scene.add(directionalLight1);

        const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.2);
        directionalLight2.position.set(-2, 2, -2);
        directionalLight2.castShadow = true;
        scene.add(directionalLight2);

        const pointLight = new THREE.PointLight(0xffffff, 0.3);
        pointLight.position.set(2, 3, 4);
        scene.add(pointLight);
      }

      const spotLight = new THREE.SpotLight(0xffffff);
      spotLight.position.set(0, 5, 5);
      spotLight.castShadow = true;
      scene.add(spotLight);

      function animate() {
        const elapsedTime = clock.getElapsedTime();
        uniforms.u_time.value = elapsedTime;
        if (gltfModel) {
        }
        controls.update();
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      }

      function onResize() {
        sizes.width = container.offsetWidth;
        sizes.height = container.offsetHeight;
        camera.aspect = sizes.width / sizes.height;
        camera.updateProjectionMatrix();
        renderer.setSize(sizes.width, sizes.height);
        if (isMobileDevice()) {
          container.style.height = "450px"; 
          container.style.marginTop = "-200px"; 
        } else if (isTabletDevice()) {
          container.style.height = "450px"; 
          container.style.marginTop = "-300"; 
        } // else {
        //   container.style.height = '450px';
        //   container.style.marginTop = '0';
        // }
        if (planeMesh) {
          if (isMobileDevice()) {
            planeMesh.position.y = -1.5; 
          } else {
            planeMesh.position.y = -3; 
          }
        }
      }

      function main() {
        addLights();
        loadGLTFModel();
        loadShadowTexture();
        animate();
        window.addEventListener("resize", onResize);
      }
      main();
    </script>
  </body>
</html>
